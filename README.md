# üèóÔ∏è Terraform Infrastructure - Clean Structure

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

# üèóÔ∏è AWS Terraform Infrastructure - –ú–æ–¥—É–ª—å–Ω–∞ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

## üìã –û–≥–ª—è–¥ –ø—Ä–æ–µ–∫—Ç—É

–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π Terraform –ø—Ä–æ–µ–∫—Ç –∑ –º–æ–¥—É–ª—å–Ω–æ—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é –¥–ª—è AWS —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏. –î–µ–º–æ–Ω—Å—Ç—Ä—É—î best practices –¥–ª—è —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ –º—ñ–∂ –º–æ–¥—É–ª—è–º–∏, –±–µ–∫–µ–Ω–¥ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é —Ç–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞–º–∏ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
l-5/
‚îú‚îÄ‚îÄ modules/                   # üì¶ –ü–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω—ñ –º–æ–¥—É–ª—ñ
‚îÇ   ‚îú‚îÄ‚îÄ s3-backend/            # S3 + DynamoDB backend
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf            # S3 bucket –∑ –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è–º —ñ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf       # –ó–º—ñ–Ω–Ω—ñ –º–æ–¥—É–ª—é
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf         # ARN —Ç–∞ –Ω–∞–∑–≤–∏ —Ä–µ—Å—É—Ä—Å—ñ–≤
‚îÇ   ‚îú‚îÄ‚îÄ vpc/                   # VPC –∑ –ø—ñ–¥–º–µ—Ä–µ–∂–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf            # VPC, –ø—ñ–¥–º–µ—Ä–µ–∂—ñ, IGW, Route Tables
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf       # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –º–µ—Ä–µ–∂—ñ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf         # ID –º–µ—Ä–µ–∂–µ–≤–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ecr/                   # ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
‚îÇ       ‚îú‚îÄ‚îÄ main.tf            # ECR –∑ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è–º —ñ –ø–æ–ª—ñ—Ç–∏–∫–∞–º–∏
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf       # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
‚îÇ       ‚îî‚îÄ‚îÄ outputs.tf         # URL —Ç–∞ ARN —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
‚îú‚îÄ‚îÄ backend/                   # üóÑÔ∏è Backend —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ main.tf                # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è S3 + DynamoDB
‚îÇ   ‚îú‚îÄ‚îÄ variables.tf           # –ó–º—ñ–Ω–Ω—ñ –±–µ–∫–µ–Ω–¥—É
‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf             # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–ª—è environments
‚îÇ   ‚îî‚îÄ‚îÄ terraform.tfvars       # –ó–Ω–∞—á–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö
‚îî‚îÄ‚îÄ environments/              # üåç –°–µ—Ä–µ–¥–æ–≤–∏—â–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
    ‚îî‚îÄ‚îÄ dev/                   # Development —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
        ‚îú‚îÄ‚îÄ main.tf            # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è dev —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
        ‚îú‚îÄ‚îÄ variables.tf       # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è dev
        ‚îú‚îÄ‚îÄ outputs.tf         # Outputs dev —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
        ‚îú‚îÄ‚îÄ locals.tf          # –õ–æ–∫–∞–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ —Ç–µ–≥–∏
        ‚îú‚îÄ‚îÄ data.tf            # Data sources
        ‚îî‚îÄ‚îÄ terraform.tfvars   # –ó–Ω–∞—á–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö dev
```

## üéØ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏

### üîÑ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ

1. **–ú–æ–¥—É–ª—ñ** (`modules/`) - –ü–µ—Ä–µ—ñ—Å–ø–æ–ª—å–∑–æ–≤—É—î–º—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
2. **–ë–µ–∫–µ–Ω–¥** (`backend/`) - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è state
3. **–°–µ—Ä–µ–¥–æ–≤–∏—â–∞** (`environments/`) - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö env

### ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ —Ç–∞–∫–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É

- üîí **–ë–µ–∑–ø–µ–∫–∞ state**: –í—ñ–¥–¥–∞–ª–µ–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è–º DynamoDB
- üèóÔ∏è **–ú–æ–¥—É–ª—å–Ω—ñ—Å—Ç—å**: –ü–µ—Ä–µ—ñ—Å–ø–æ–ª—å–∑—É–≤–∞–Ω–Ω—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –º—ñ–∂ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- üåç **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –õ–µ–≥–∫–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â
- üöÄ **DRY –ø—Ä–∏–Ω—Ü–∏–ø**: –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É
- üîß **–Ü–∑–æ–ª—è—Ü—ñ—è**: –û–∫—Ä–µ–º—ñ state —Ñ–∞–π–ª–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

## üöÄ –ü–æ–∫—Ä–æ–∫–æ–≤–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Backend Infrastructure

```bash
# –ü–µ—Ä–µ—Ö—ñ–¥ —É backend –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
cd backend/

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Terraform (–ª–æ–∫–∞–ª—å–Ω–∏–π state)
terraform init

# –ü–µ—Ä–µ–≥–ª—è–¥ –ø–ª–∞–Ω—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è backend —Ä–µ—Å—É—Ä—Å—ñ–≤
terraform plan

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è S3 bucket —Ç–∞ DynamoDB —Ç–∞–±–ª–∏—Ü—ñ
terraform apply -auto-approve

# –ü–µ—Ä–µ–≥–ª—è–¥ outputs –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫—Ä–æ–∫—É
terraform output
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è S3 bucket `lesson-5-dev-tfstate-190403256762` —Ç–∞ DynamoDB —Ç–∞–±–ª–∏—Ü—è `lesson-5-dev-terraform-locks`

### –ö—Ä–æ–∫ 2: –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Dev Environment

```bash
# –ü–µ—Ä–µ—Ö—ñ–¥ —É dev —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
cd ../environments/dev/

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑ remote backend (S3 + DynamoDB)
terraform init

# –ü–µ—Ä–µ–≥–ª—è–¥ –ø–ª–∞–Ω—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
terraform plan

# –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è VPC, –ø—ñ–¥–º–µ—Ä–µ–∂ —Ç–∞ ECR
terraform apply -auto-approve

# –ü–µ—Ä–µ–≥–ª—è–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
terraform output
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –ø–æ–≤–Ω–∞ AWS —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑ VPC, –ø—ñ–¥–º–µ—Ä–µ–∂–∞–º–∏ —Ç–∞ ECR

## üèõÔ∏è –°—Ç–≤–æ—Ä–µ–Ω–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### üåê –ú–µ—Ä–µ–∂–µ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ (VPC)

```
VPC: lesson-5-dev-vpc (10.0.0.0/16)
‚îú‚îÄ‚îÄ –ü—É–±–ª—ñ—á–Ω—ñ –ø—ñ–¥–º–µ—Ä–µ–∂—ñ (web tier):
‚îÇ   ‚îú‚îÄ‚îÄ us-east-1a: lesson-5-dev-vpc-public-a  (10.0.1.0/24)
‚îÇ   ‚îú‚îÄ‚îÄ us-east-1b: lesson-5-dev-vpc-public-b  (10.0.2.0/24)
‚îÇ   ‚îî‚îÄ‚îÄ us-east-1c: lesson-5-dev-vpc-public-c  (10.0.3.0/24)
‚îú‚îÄ‚îÄ –ü—Ä–∏–≤–∞—Ç–Ω—ñ –ø—ñ–¥–º–µ—Ä–µ–∂—ñ (app tier):
‚îÇ   ‚îú‚îÄ‚îÄ us-east-1a: lesson-5-dev-vpc-private-a (10.0.4.0/24)
‚îÇ   ‚îú‚îÄ‚îÄ us-east-1b: lesson-5-dev-vpc-private-b (10.0.5.0/24)
‚îÇ   ‚îî‚îÄ‚îÄ us-east-1c: lesson-5-dev-vpc-private-c (10.0.6.0/24)
‚îú‚îÄ‚îÄ Internet Gateway: lesson-5-dev-vpc-igw
‚îî‚îÄ‚îÄ Route Tables: –æ–∫—Ä–µ–º—ñ –¥–ª—è –ø—É–±–ª—ñ—á–Ω–∏—Ö —Ç–∞ –∫–æ–∂–Ω–æ—ó –ø—Ä–∏–≤–∞—Ç–Ω–æ—ó –ø—ñ–¥–º–µ—Ä–µ–∂—ñ
```

### üì¶ ECR Repository

- **–ù–∞–∑–≤–∞**: `lesson-5-dev-ecr`
- **URL**: `https://190403256762.dkr.ecr.us-east-1.amazonaws.com/lesson-5-dev-ecr`
- **–§—É–Ω–∫—Ü—ñ—ó**: 
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ
  - –ú—É—Ç–∞–±–µ–ª—å–Ω—ñ —Ç–µ–≥–∏
  - –û–±–º–µ–∂–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É

### üóÑÔ∏è Backend Infrastructure

- **S3 Bucket**: `lesson-5-dev-tfstate-190403256762`
  - –í–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è —É–≤—ñ–º–∫–Ω–µ–Ω–æ
  - Server-side —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è (AES256)
  - –ü—É–±–ª—ñ—á–Ω–∏–π –¥–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π
- **DynamoDB Table**: `lesson-5-dev-terraform-locks`
  - –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è state —Ñ–∞–π–ª—ñ–≤
  - Prevent destroy —É–≤—ñ–º–∫–Ω–µ–Ω–æ

## üìä Outputs –ø—ñ—Å–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

```
availability_zones    = ["us-east-1a", "us-east-1b", "us-east-1c"]
aws_region           = "us-east-1"
ecr_repository_name  = "lesson-5-dev-ecr"
ecr_repository_url   = "https://190403256762.dkr.ecr.us-east-1.amazonaws.com/lesson-5-dev-ecr"
environment          = "dev"
private_subnets      = ["subnet-xxx", "subnet-yyy", "subnet-zzz"]
public_subnets       = ["subnet-aaa", "subnet-bbb", "subnet-ccc"]
project_name         = "lesson-5"
resource_prefix      = "lesson-5-dev"
vpc_cidr_block       = "10.0.0.0/16"
vpc_id               = "vpc-xxx"
```

## üîß –ú–æ–¥—É–ª—ñ –¥–µ—Ç–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

### S3 Backend –º–æ–¥—É–ª—å (`modules/s3-backend/`)

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –ë–µ–∑–ø–µ—á–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è Terraform state —Ñ–∞–π–ª—ñ–≤

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏**:
- S3 bucket –∑ —É–Ω—ñ–∫–∞–ª—å–Ω–æ—é –Ω–∞–∑–≤–æ—é
- –í–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ lifecycle –ø—Ä–∞–≤–∏–ª–∞
- Server-side —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è (AES256)
- –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
- DynamoDB —Ç–∞–±–ª–∏—Ü—è –¥–ª—è state locking
- Prevent destroy –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤

### VPC –º–æ–¥—É–ª—å (`modules/vpc/`)

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–µ—Ä–µ–∂–µ–≤–æ—ó —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏**:
- VPC –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é DNS hostnames/resolution
- –î–∏–Ω–∞–º—ñ—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–º–µ—Ä–µ–∂ –≤ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö AZ
- –ü—É–±–ª—ñ—á–Ω—ñ –ø—ñ–¥–º–µ—Ä–µ–∂—ñ –∑ auto-assign public IP
- –ü—Ä–∏–≤–∞—Ç–Ω—ñ –ø—ñ–¥–º–µ—Ä–µ–∂—ñ –¥–ª—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤
- Internet Gateway –¥–ª—è –ø—É–±–ª—ñ—á–Ω–∏—Ö –ø—ñ–¥–º–µ—Ä–µ–∂
- –û–∫—Ä–µ–º—ñ Route Tables –¥–ª—è –∫–æ–∂–Ω–æ—ó –ø—Ä–∏–≤–∞—Ç–Ω–æ—ó –ø—ñ–¥–º–µ—Ä–µ–∂—ñ

### ECR –º–æ–¥—É–ª—å (`modules/ecr/`)

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏**:
- ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è–º
- –ü–æ–ª—ñ—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø—É –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É AWS
- –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –º—É—Ç–∞–±–µ–ª—å–Ω–∏—Ö —Ç–µ–≥—ñ–≤
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º —Ç–µ–≥—É–≤–∞–Ω–Ω—è–º

## üè∑Ô∏è –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–≥—ñ–≤

–í—Å—ñ —Ä–µ—Å—É—Ä—Å–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º—É—é—Ç—å —Ç–µ–≥–∏:

```hcl
common_tags = {
  Project     = "lesson-5"
  Environment = "dev" 
  ManagedBy   = "terraform"
  Owner       = "akolvakh"
}
```

## üåü –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Staging Environment

```bash
# 1. –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è dev –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
cp -r environments/dev environments/staging

# 2. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
cd environments/staging
sed -i 's/dev/staging/g' terraform.tfvars
sed -i 's/dev/staging/g' locals.tf

# 3. –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
terraform init
terraform plan
terraform apply
```

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Production Environment

```bash
# 1. –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è dev –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó  
cp -r environments/dev environments/prod

# 2. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
cd environments/prod
# –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ terraform.tfvars —Ç–∞ locals.tf
# –ú–æ–∂–ª–∏–≤–æ –∑–º—ñ–Ω–∏—Ç–∏ CIDR –±–ª–æ–∫–∏ –¥–ª—è —ñ–∑–æ–ª—è—Ü—ñ—ó

# 3. –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
terraform init
terraform plan
terraform apply
```

## üîí –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ Best Practices

### –Ü–º–ø–ª–µ–º–µ–Ω—Ç–æ–≤–∞–Ω—ñ –∑–∞—Ö–æ–¥–∏ –±–µ–∑–ø–µ–∫–∏

- ‚úÖ **–í—ñ–¥–¥–∞–ª–µ–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è state** –∑ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è–º
- ‚úÖ **DynamoDB –±–ª–æ–∫—É–≤–∞–Ω–Ω—è** –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∞–º
- ‚úÖ **ECR —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è** –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ
- ‚úÖ **IAM –ø–æ–ª—ñ—Ç–∏–∫–∏** –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏
- ‚úÖ **–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É** –¥–æ S3
- ‚úÖ **–í–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è** –≤—Å—ñ—Ö –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –ø–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—é

1. **–ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ** `terraform plan` –ø–µ—Ä–µ–¥ `apply`
2. **–†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ–±—ñ—Ç—å backup** `backend/terraform.tfstate`
3. **–¢–µ—Å—Ç—É–π—Ç–µ –∑–º—ñ–Ω–∏** —Å–ø–æ—á–∞—Ç–∫—É –≤ dev —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ
4. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä—ñ–∑–Ω—ñ AWS –∞–∫–∫–∞—É–Ω—Ç–∏** –¥–ª—è prod —Ç–∞ dev
5. **–ú–æ–Ω—ñ—Ç–æ—Ä—å—Ç–µ –≤–∏—Ç—Ä–∞—Ç–∏** —á–µ—Ä–µ–∑ AWS Cost Explorer

## üõ†Ô∏è –û–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π workflow

```bash
# Backend management
cd backend/
terraform plan && terraform apply

# Environment management  
cd environments/dev/
terraform plan && terraform apply

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É
terraform show
terraform output

# –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∫–æ–¥—É
terraform fmt -recursive

# –í–∞–ª—ñ–¥–∞—Ü—ñ—è
terraform validate
```

### Troubleshooting –∫–æ–º–∞–Ω–¥–∏

```bash
# –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è state (–æ–±–µ—Ä–µ–∂–Ω–æ!)
terraform force-unlock LOCK_ID

# –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤
terraform get -update
terraform init -upgrade

# –î–µ—Ç–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω
terraform plan -detailed-exitcode

# –Ü–º–ø–æ—Ä—Ç —ñ—Å–Ω—É—é—á–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤
terraform import <resource_type>.<name> <resource_id>
```

## üìà –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤–∏—Ç—Ä–∞—Ç

### –û—á—ñ–∫—É–≤–∞–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ (—â–æ–º—ñ—Å—è—á–Ω–æ)

- **S3 storage**: ~$0.01-0.10 (–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–æ–∑–º—ñ—Ä—É state)
- **DynamoDB**: –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ (free tier)
- **VPC**: –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ (–±–∞–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å)
- **ECR**: –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ –¥–æ 500MB
- **Data transfer**: –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–æ

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–ª–µ—Ä—Ç—ñ–≤

```bash
# AWS CLI –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è budget alert
aws budgets create-budget 
  --account-id YOUR_ACCOUNT_ID 
  --budget file://budget-config.json
```

## üìö –ö–æ—Ä–∏—Å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏

- [Terraform AWS Provider Documentation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [AWS VPC Best Practices](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-best-practices.html)
- [Terraform State Management](https://www.terraform.io/docs/language/state/index.html)

## üßπ –û—á–∏—â–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤

```bash
# 1. –í–∏–¥–∞–ª–µ–Ω–Ω—è environment —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
cd environments/dev/
terraform destroy -auto-approve

# 2. –í–∏–¥–∞–ª–µ–Ω–Ω—è backend —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ (–æ—Å—Ç–∞–Ω–Ω—ñ–º –∫—Ä–æ–∫–æ–º!)
cd ../../backend/
terraform destroy -auto-approve
```

**‚ö†Ô∏è –£–í–ê–ì–ê**: Backend destroy –≤–∏–¥–∞–ª–∏—Ç—å –≤—Å—ñ state —Ñ–∞–π–ª–∏!

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞

**–ê–≤—Ç–æ—Ä**: Anton Kolvakh  
**–ü—Ä–æ–µ–∫—Ç**: GoIT DevOps - –£—Ä–æ–∫ 5  
**–í–µ—Ä—Å—ñ—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏**: 2.0 (Modular)  
**–î–∞—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è**: –ì—Ä—É–¥–µ–Ω—å 2024  

---

*–¶–µ–π –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î enterprise-grade –ø—ñ–¥—Ö—ñ–¥ –¥–æ Infrastructure as Code –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Terraform —Ç–∞ AWS.*

## üöÄ –ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è

### –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Backend Infrastructure

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ backend –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
cd backend

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è (–ª–æ–∫–∞–ª—å–Ω–∏–π state)
terraform init

# –°—Ç–≤–æ—Ä–∏—Ç–∏ backend —Ä–µ—Å—É—Ä—Å–∏
terraform plan
terraform apply

# –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –¥–ª—è environments
terraform output backend_config
```

### –ö—Ä–æ–∫ 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Environment

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ dev environment
cd ../environments/dev

# –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ backend config –∑ outputs –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∫—Ä–æ–∫—É
# –í—ñ–¥–∫–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏ backend –±–ª–æ–∫ –≤ main.tf —Ç–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑ remote backend
terraform init

# –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
terraform plan
terraform apply
```

## üéØ –ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–æ–≤–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏

### ‚úÖ **–ß–∏—Å—Ç–æ—Ç–∞ —ñ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è**
- **–ú–æ–¥—É–ª—ñ**: –ü–µ—Ä–µ—ñ—Å–ø–æ–ª—å–∑—É–µ–º—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
- **Backend**: –û–∫—Ä–µ–º–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è state
- **Environments**: –Ü–∑–æ–ª—å–æ–≤–∞–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

### ‚úÖ **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**
- –õ–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ prod/staging environments
- –ú–æ–¥—É–ª—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ —ñ–Ω—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- Backend —Å–ø—ñ–ª—å–Ω–∏–π –¥–ª—è –≤—Å—ñ—Ö environments

### ‚úÖ **–ë–µ–∑–ø–µ–∫–∞**
- Backend —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∞
- –û–∫—Ä–µ–º—ñ state —Ñ–∞–π–ª–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ environment
- –ù–µ–º–∞—î —Ü–∏–∫–ª—ñ—á–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

## üîÑ Workflow

1. **–û–¥–∏–Ω —Ä–∞–∑**: –°—Ç–≤–æ—Ä–∏—Ç–∏ backend —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
2. **–î–ª—è –∫–æ–∂–Ω–æ–≥–æ environment**: 
   - –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ backend config
   - –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
   - –£–ø—Ä–∞–≤–ª—è—Ç–∏ –∑–º—ñ–Ω–∞–º–∏

## üìù –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö environments

```bash
# –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –ø–∞–ø–∫—É
mkdir environments/prod
cp -r environments/dev/* environments/prod/

# –í—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ terraform.tfvars –¥–ª—è prod
vim environments/prod/terraform.tfvars

# –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏
cd environments/prod
terraform init
terraform apply
```

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –º–æ–¥—É–ª—è–º–∏

–ú–æ–¥—É–ª—ñ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ `modules/` —ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏:
- –û–Ω–æ–≤–ª–µ–Ω—ñ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
- –í–µ—Ä—Å—ñ–æ–Ω–æ–≤–∞–Ω—ñ
- –ü–µ—Ä–µ—ñ—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ñ –≤ —Ä—ñ–∑–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏

1. **Backend state** –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ `backend/terraform.tfstate`
2. **Environment state** –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ S3 remote backend
3. –ó–∞–≤–∂–¥–∏ —Å–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—é–π—Ç–µ backend, –ø–æ—Ç—ñ–º environments
4. Backup —Ñ–∞–π–ª `backend/terraform.tfstate` —É –±–µ–∑–ø–µ—á–Ω–æ–º—É –º—ñ—Å—Ü—ñ

## üîß –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏

```bash
# Backend
cd backend && terraform apply

# Dev environment
cd environments/dev && terraform apply

# Prod environment (–ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è)
cd environments/prod && terraform apply
```
